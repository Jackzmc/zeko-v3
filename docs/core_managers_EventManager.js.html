<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: core/managers/EventManager.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: core/managers/EventManager.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**  
  @module core:managers/EventManager
  @description Manages the events, and passes fired events to registered event handlers
*/

import path from 'path'
import Logger from '../Logger.js'
let logger

export default class {
    constructor(client) {
        this.events = {
            core: new Map(),
            custom: new Map(),
        }
        this.client = client;
        logger = new Logger('EventManager',{ type: 'module' });
    }

    
    /**
     * All events fire this method
     *
     * @param {string} name The name of event
     * @param {*} args Any discord.js event arguments
     */
    event(name, args) {
        if(name.toLowerCase() === "guildmemberspeaking") return;
        const core = this.getCoreEvent(name);
        const custom = this.getCustomEvent(name);
        if(custom) {
            Promise.resolve(custom.event.before(...args))
            .then(beforeResponse => {
                if(beforeResponse !== true &amp;&amp; custom.event.after) {
                    if(core) {
                        Promise.resolve(core.event.every(...args))
                        .then(coreResponse => {
                            if(coreResponse !== true) custom.event.after(...args);
                        }).catch(err => {
                            logger.error(`Core Event ${name} errored: ${process.env.PRODUCTION?err.message:err.stack}`)
                        })
                    }else{
                        custom.event.after(...args)
                    }
                }
            })
        }else if(core) {
            Promise.resolve(core.event.every(...args))
            .catch(err => {
                logger.error(`Core Event ${name} errored: ${err.message}`)
            })
        }
    }


    /**
     * Register an event handler for EventManager
     *
     * @param {string} name Name of the event
     * @param {boolean} isCore Is the event a core event? (Internal use only)
     * @returns Promise&lt;>
     */
    registerEvent(name, isCore) {
        const _this = this;
        return new Promise(async(resolve,reject) => {
            try {
                const filepath = path.join(_this.client.ROOT_DIR, isCore?"src/events":"events",`${name}.js`)
                //delete require.cache[require.resolve(_path)];
                const event_src = await import(`file://${filepath}`);
                const event = new event_src.default(this.client, new Logger(name))
                if(isCore &amp;&amp; (typeof event.every !== "function" &amp;&amp; typeof event.once !== "function")) {
                    return reject(new Error("Invalid CoreEvent class: Missing valid 'every' or 'once' method"))
                }else if(!isCore &amp;&amp; typeof event.before !== "function" &amp;&amp; typeof event.after !== "function") {
                    return reject(new Error("Invalid (Custom) Event class: Missing valid 'before' or 'after' method"))
                }
                
                const registeredEvent = {
                    event,
                    config: {
                        core: isCore,
                        name,
                    }
                }
                if(isCore) {
                    _this.events.core.set(name, registeredEvent)
                }else{
                    _this.events.custom.set(name, registeredEvent)
                }
                resolve();
            }catch(err) {
                reject(err);
            }
        })
    }


    /**
     * Attempt to fetch a core event by name
     *
     * @param {string} query The name of the event
     * @returns EventObject
     */
    getCoreEvent(query) {
        return this.events.core.get(query)
    } 

    /**
     * Attempt to fetch a custom event by name
     *
     * @param {string} query The name of the event
     * @returns EventObject
     */
    getCustomEvent(query) {
        return this.events.custom.get(query)
    }

    
    /**
     * Returns all events, either name or full object.
     *
     * @param {boolean} [namesOnly=true] Should only the names of the events be provided
     * @returns Array[string] or Array[EventObject]
     */
    getEvents(namesOnly = true) {
        if(namesOnly) {
            return {
                core:Object.keys(this.events.core.values()),
                custom:Object.keys(this.events.custom.values())
            }
        }else{
            return {
                core: this.events.core.values(),
                custom: this.events.custom.values()
            }
        }
    }

}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="core_Database.html">core:Database</a></li><li><a href="core_loaders_CommandLoader.html">core:loaders/CommandLoader</a></li><li><a href="core_loaders_CoreLoader.html">core:loaders/CoreLoader</a></li><li><a href="core_loaders_EventLoader.html">core:loaders/EventLoader</a></li><li><a href="core_loaders_ModuleLoader.html">core:loaders/ModuleLoader</a></li><li><a href="core_managers_CommandManager.html">core:managers/CommandManager</a></li><li><a href="core_managers_DataManager.html">core:managers/DataManager</a></li><li><a href="core_managers_EventManager.html">core:managers/EventManager</a></li><li><a href="core_managers_ModuleManager.html">core:managers/ModuleManager</a></li><li><a href="core_types_CoreEvent.html">core:types/CoreEvent</a></li><li><a href="module-types_Event.html">types/Event</a></li><li><a href="module-Utils.html">Utils</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sun Jun 28 2020 15:03:35 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
